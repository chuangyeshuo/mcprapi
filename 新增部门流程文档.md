# MCP RAPI ç®¡ç†ç³»ç»Ÿ - æ–°å¢éƒ¨é—¨å®Œæ•´æµç¨‹æŒ‡å—

> ğŸ“– æœ¬æ–‡æ¡£æä¾›äº†åœ¨ MCP RAPI ç®¡ç†ç³»ç»Ÿä¸­æ–°å¢éƒ¨é—¨çš„å®Œæ•´æ“ä½œæŒ‡å—ï¼ŒåŒ…æ‹¬éƒ¨é—¨åˆ›å»ºã€æƒé™é…ç½®ã€ç”¨æˆ·ç®¡ç†ç­‰å…¨æµç¨‹æ­¥éª¤ã€‚

## ğŸ“‹ æµç¨‹æ¦‚è§ˆ

### ğŸ”„ æ“ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºéƒ¨é—¨  â”‚â”€â”€â”€â–¶â”‚ 2. åˆ›å»ºè§’è‰²  â”‚â”€â”€â”€â–¶â”‚ 3. åˆ›å»ºç”¨æˆ·  â”‚â”€â”€â”€â–¶â”‚ 4. é…ç½®APIæƒé™â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å®Œæˆ     â”‚â—€â”€â”€â”€â”‚ 7. APIæµ‹è¯•   â”‚â—€â”€â”€â”€â”‚ 6. ç™»å½•éªŒè¯  â”‚â—€â”€â”€â”€â”‚ 5. é…ç½®èœå•æƒé™â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ è¯¦ç»†æ­¥éª¤åˆ—è¡¨

1. **ğŸ¢ åˆ›å»ºéƒ¨é—¨** â†’ å»ºç«‹ç»„ç»‡æ¶æ„åŸºç¡€
2. **ğŸ‘¥ åˆ›å»ºè§’è‰²** â†’ å®šä¹‰æƒé™è§’è‰²æ¨¡æ¿  
3. **ğŸ‘¤ åˆ›å»ºç”¨æˆ·** â†’ æ·»åŠ å…·ä½“æ“ä½œäººå‘˜
4. **ğŸ” é…ç½®APIæƒé™** â†’ è®¾ç½®åç«¯æ¥å£è®¿é—®æƒé™
5. **ğŸ›ï¸ é…ç½®èœå•æƒé™** â†’ è®¾ç½®å‰ç«¯é¡µé¢è®¿é—®æƒé™
6. **ğŸŒ ç™»å½•éªŒè¯** â†’ éªŒè¯ç”¨æˆ·ç™»å½•å’ŒåŸºç¡€åŠŸèƒ½
7. **ğŸ§ª APIæµ‹è¯•** â†’ æµ‹è¯•æ¥å£æƒé™æ˜¯å¦æ­£ç¡®
8. **âœ… å®Œæˆ** â†’ éƒ¨é—¨åˆ›å»ºæµç¨‹ç»“æŸ

### ğŸ”„ Mermaid æµç¨‹å›¾ï¼ˆæ”¯æŒ Mermaid çš„ç¼–è¾‘å™¨å¯æŸ¥çœ‹ï¼‰

```mermaid
graph TD
    A[1. åˆ›å»ºéƒ¨é—¨] --> B[2. åˆ›å»ºè§’è‰²]
    B --> C[3. åˆ›å»ºç”¨æˆ·]
    C --> D[4. é…ç½®APIæƒé™]
    D --> E[5. é…ç½®èœå•æƒé™]
    E --> F[6. ç™»å½•éªŒè¯]
    F --> G[7. APIæµ‹è¯•]
    G --> H[âœ… å®Œæˆ]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#e0f2f1
    style G fill:#f1f8e9
    style H fill:#e8eaf6
```

### ğŸ¯ é¢„è®¡å®Œæˆæ—¶é—´
- **æ€»æ—¶é•¿**ï¼š15-20åˆ†é’Ÿ
- **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­â˜†â˜†ï¼ˆä¸­ç­‰ï¼‰

---

## ğŸ¢ æ­¥éª¤1ï¼šåˆ›å»ºéƒ¨é—¨

### ğŸ“ æ“ä½œè·¯å¾„
**ç³»ç»Ÿç®¡ç†** â†’ **éƒ¨é—¨ç®¡ç†** â†’ **æ–°å¢**

### ğŸ“ å¡«å†™ä¿¡æ¯
| å­—æ®µ | ç¤ºä¾‹å€¼ | è¯´æ˜ | å¿…å¡« |
|------|--------|------|------|
| éƒ¨é—¨åç§° | `AIç ”å‘éƒ¨` | éƒ¨é—¨çš„æ˜¾ç¤ºåç§° | âœ… |
| éƒ¨é—¨ä»£ç  | `aigc` | éƒ¨é—¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè‹±æ–‡/æ•°å­—ï¼‰ | âœ… |
| ä¸Šçº§éƒ¨é—¨ | `æŠ€æœ¯ä¸­å¿ƒ` | é€‰æ‹©ä¸Šçº§éƒ¨é—¨ï¼ˆå¯é€‰ï¼‰ | âŒ |
| éƒ¨é—¨æè¿° | `è´Ÿè´£AIäº§å“ç ”å‘` | éƒ¨é—¨èŒèƒ½æè¿° | âŒ |
| æ’åº | `10` | æ˜¾ç¤ºé¡ºåº | âŒ |
| çŠ¶æ€ | `å¯ç”¨` | éƒ¨é—¨çŠ¶æ€ | âœ… |

### âœ… éªŒè¯ç»“æœ
- éƒ¨é—¨åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°åˆ›å»ºçš„éƒ¨é—¨
- éƒ¨é—¨ä»£ç å”¯ä¸€æ€§æ£€æŸ¥é€šè¿‡

---

## ğŸ‘¥ æ­¥éª¤2ï¼šåˆ›å»ºè§’è‰²

### ğŸ“ æ“ä½œè·¯å¾„
**ç³»ç»Ÿç®¡ç†** â†’ **è§’è‰²ç®¡ç†** â†’ **æ–°å¢**

### ğŸ“ å¡«å†™ä¿¡æ¯
| å­—æ®µ | ç¤ºä¾‹å€¼ | è¯´æ˜ | å¿…å¡« |
|------|--------|------|------|
| è§’è‰²åç§° | `AIç ”å‘å·¥ç¨‹å¸ˆ` | è§’è‰²çš„æ˜¾ç¤ºåç§° | âœ… |
| è§’è‰²ä»£ç  | `aigc_engineer` | è§’è‰²å”¯ä¸€æ ‡è¯†ç¬¦ | âœ… |
| æ‰€å±éƒ¨é—¨ | `AIç ”å‘éƒ¨` | é€‰æ‹©å¯¹åº”éƒ¨é—¨ | âœ… |
| è§’è‰²æè¿° | `AIç ”å‘ç›¸å…³å·¥ä½œæƒé™` | è§’è‰²èŒè´£æè¿° | âŒ |
| çŠ¶æ€ | `å¯ç”¨` | è§’è‰²çŠ¶æ€ | âœ… |

### ğŸ’¡ å‘½åå»ºè®®
- è§’è‰²ä»£ç å»ºè®®æ ¼å¼ï¼š`{éƒ¨é—¨ä»£ç }_{èŒä½}`
- ä¾‹å¦‚ï¼š`aigc_engineer`ã€`aigc_manager`ã€`aigc_intern`

### âœ… éªŒè¯ç»“æœ
- è§’è‰²åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°åˆ›å»ºçš„è§’è‰²
- è§’è‰²ä¸éƒ¨é—¨å…³è”æ­£ç¡®

---

## ğŸ‘¤ æ­¥éª¤3ï¼šåˆ›å»ºç”¨æˆ·

### ğŸ“ æ“ä½œè·¯å¾„
**ç³»ç»Ÿç®¡ç†** â†’ **ç”¨æˆ·ç®¡ç†** â†’ **æ–°å¢**

### ğŸ“ å¡«å†™ä¿¡æ¯
| å­—æ®µ | ç¤ºä¾‹å€¼ | è¯´æ˜ | å¿…å¡« |
|------|--------|------|------|
| ç”¨æˆ·å | `aigc_user` | ç™»å½•ç”¨æˆ·åï¼ˆè‹±æ–‡/æ•°å­—ï¼‰ | âœ… |
| å§“å | `å¼ ä¸‰` | ç”¨æˆ·çœŸå®å§“å | âœ… |
| å¯†ç  | `Abc123456!` | ç™»å½•å¯†ç ï¼ˆå»ºè®®8ä½ä»¥ä¸Šï¼‰ | âœ… |
| ç¡®è®¤å¯†ç  | `Abc123456!` | å†æ¬¡è¾“å…¥å¯†ç  | âœ… |
| é‚®ç®± | `zhangsan@company.com` | ç”¨æˆ·é‚®ç®±åœ°å€ | âœ… |
| æ‰‹æœºå· | `13800138000` | è”ç³»ç”µè¯ | âŒ |
| æ‰€å±éƒ¨é—¨ | `AIç ”å‘éƒ¨` | é€‰æ‹©å¯¹åº”éƒ¨é—¨ | âœ… |
| è§’è‰² | `AIç ”å‘å·¥ç¨‹å¸ˆ` | é€‰æ‹©å¯¹åº”è§’è‰² | âœ… |
| çŠ¶æ€ | `å¯ç”¨` | ç”¨æˆ·çŠ¶æ€ | âœ… |

### ğŸ”’ å¯†ç è¦æ±‚
- é•¿åº¦ï¼š8-20ä½
- åŒ…å«ï¼šå¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
- é¿å…ï¼šå¼±å¯†ç å¦‚ `123456`ã€`password`

### âœ… éªŒè¯ç»“æœ
- ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°åˆ›å»ºçš„ç”¨æˆ·
- ç”¨æˆ·ä¸éƒ¨é—¨ã€è§’è‰²å…³è”æ­£ç¡®

---

## ğŸ” æ­¥éª¤4ï¼šé…ç½®APIæƒé™

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç®¡ç†ç•Œé¢ï¼ˆæ¨èï¼‰

#### ğŸ“ æ“ä½œè·¯å¾„
**æƒé™ç®¡ç†** â†’ **APIæƒé™** â†’ **è§’è‰²æƒé™é…ç½®**

#### ğŸ“ é…ç½®æ­¥éª¤
1. é€‰æ‹©è§’è‰²ï¼š`AIç ”å‘å·¥ç¨‹å¸ˆ`
2. é…ç½®APIæƒé™ï¼š

| APIè·¯å¾„ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|---------|------|------|------|
| `/api/v1/apis*` | `*` | `å…è®¸` | APIç®¡ç†æƒé™ |
| `/api/v1/business*` | `*` | `å…è®¸` | ä¸šåŠ¡çº¿ç®¡ç†æƒé™ |
| `/api/v1/departments*` | `GET` | `å…è®¸` | éƒ¨é—¨æŸ¥çœ‹æƒé™ |
| `/api/v1/users*` | `GET,POST,PUT` | `å…è®¸` | ç”¨æˆ·ç®¡ç†æƒé™ |

### æ–¹å¼äºŒï¼šæ•°æ®åº“ç›´æ¥é…ç½®

```sql
-- è¿æ¥æ•°æ®åº“
USE api_auth_dev;

-- æ·»åŠ APIæƒé™è§„åˆ™
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3, v4, v5) VALUES 
('p', 'aigc_engineer', '/api/v1/apis*', '*', '*', 'allow', ''),
('p', 'aigc_engineer', '/api/v1/apis/*', '*', '*', 'allow', ''),
('p', 'aigc_engineer', '/api/v1/business*', '*', '*', 'allow', ''),
('p', 'aigc_engineer', '/api/v1/business/*', '*', '*', 'allow', ''),
('p', 'aigc_engineer', '/api/v1/departments*', 'GET', '*', 'allow', ''),
('p', 'aigc_engineer', '/api/v1/users*', 'GET,POST,PUT', '*', 'allow', '');

-- éªŒè¯æƒé™é…ç½®
SELECT * FROM casbin_rule WHERE v0='aigc_engineer';
```

### âœ… éªŒè¯ç»“æœ
- Casbinè§„åˆ™è¡¨ä¸­å­˜åœ¨å¯¹åº”æƒé™è®°å½•
- æƒé™é…ç½®ç•Œé¢æ˜¾ç¤ºæ­£ç¡®

---

## ğŸ›ï¸ æ­¥éª¤5ï¼šé…ç½®èœå•æƒé™

### ğŸ“ æ“ä½œè·¯å¾„
**æƒé™ç®¡ç†** â†’ **èœå•æƒé™** â†’ **è§’è‰²èœå•é…ç½®**

### ğŸ“ é…ç½®èœå•
é€‰æ‹©è§’è‰² `AIç ”å‘å·¥ç¨‹å¸ˆ`ï¼Œå‹¾é€‰ä»¥ä¸‹èœå•ï¼š

#### ğŸ  ä¸»è¦åŠŸèƒ½æ¨¡å—
- âœ… **ä¸šåŠ¡ç®¡ç†**
  - âœ… ä¸šåŠ¡çº¿åˆ—è¡¨
  - âœ… ä¸šåŠ¡çº¿åˆ›å»º
  - âœ… ä¸šåŠ¡çº¿ç¼–è¾‘
- âœ… **APIç®¡ç†**
  - âœ… APIåˆ—è¡¨
  - âœ… APIåˆ›å»º
  - âœ… APIç¼–è¾‘
  - âœ… APIæˆæƒ
- âœ… **ç”¨æˆ·ç®¡ç†**
  - âœ… ç”¨æˆ·åˆ—è¡¨
  - âœ… ç”¨æˆ·æŸ¥çœ‹

#### ğŸ”§ ç³»ç»ŸåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- âŒ éƒ¨é—¨ç®¡ç†ï¼ˆé€šå¸¸ä¸å¼€æ”¾ï¼‰
- âŒ è§’è‰²ç®¡ç†ï¼ˆé€šå¸¸ä¸å¼€æ”¾ï¼‰
- âŒ ç³»ç»Ÿè®¾ç½®ï¼ˆé€šå¸¸ä¸å¼€æ”¾ï¼‰

### âœ… éªŒè¯ç»“æœ
- èœå•æƒé™é…ç½®ä¿å­˜æˆåŠŸ
- è§’è‰²èœå•å…³è”æ­£ç¡®

---

## ğŸŒ æ­¥éª¤6ï¼šç™»å½•éªŒè¯

### ğŸ“ è®¿é—®åœ°å€
```
å‰ç«¯ç®¡ç†ç•Œé¢ï¼šhttp://localhost:8082/
åç«¯APIæœåŠ¡ï¼šhttp://localhost:8081/
```

### ğŸ“ ç™»å½•æµ‹è¯•
1. **æ‰“å¼€ç®¡ç†ç•Œé¢**ï¼š`http://localhost:8082/`
2. **è¾“å…¥ç™»å½•ä¿¡æ¯**ï¼š
   - ç”¨æˆ·åï¼š`aigc_user`
   - å¯†ç ï¼š`Abc123456!`
3. **éªŒè¯èœå•æ˜¾ç¤º**ï¼š
   - æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºé…ç½®çš„èœå•
   - éªŒè¯æ— æƒé™èœå•æ˜¯å¦éšè—

### ğŸ” åŠŸèƒ½éªŒè¯æ¸…å•
- [ ] ç™»å½•æˆåŠŸ
- [ ] ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®
- [ ] èœå•æƒé™ç”Ÿæ•ˆ
- [ ] é¡µé¢è®¿é—®æ­£å¸¸

### âœ… éªŒè¯ç»“æœ
- ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ç³»ç»Ÿ
- èœå•æ˜¾ç¤ºç¬¦åˆæƒé™é…ç½®

---

## ğŸ”‘ æ­¥éª¤7ï¼šAPI Tokenè·å–

### æ–¹å¼ä¸€ï¼šç®¡ç†ç•Œé¢ç”Ÿæˆï¼ˆæ¨èï¼‰

#### ğŸ“ æ“ä½œè·¯å¾„
**ç”¨æˆ·ç®¡ç†** â†’ **é€‰æ‹©ç”¨æˆ·** â†’ **TokenæŒ‰é’®**

#### ğŸ“ æ“ä½œæ­¥éª¤
1. **è¿›å…¥ç”¨æˆ·ç®¡ç†é¡µé¢**ï¼šåœ¨å·¦ä¾§èœå•é€‰æ‹©"ç”¨æˆ·ç®¡ç†"
2. **æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·**ï¼šåœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ° `aigc_user`
3. **ç‚¹å‡»TokenæŒ‰é’®**ï¼šåœ¨æ“ä½œåˆ—ç‚¹å‡»ç»¿è‰²çš„"Token"æŒ‰é’®
4. **æŸ¥çœ‹Tokenä¿¡æ¯**ï¼š
   - ç”¨æˆ·ä¿¡æ¯ï¼šæ˜¾ç¤ºç”¨æˆ·åå’Œé‚®ç®±
   - JWT Tokenï¼šå®Œæ•´çš„è®¿é—®ä»¤ç‰Œ
   - æ“ä½œé€‰é¡¹ï¼šåˆ·æ–°Tokenã€åˆ·æ–°Token+ç‰ˆæœ¬å·

#### ğŸ–¼ï¸ ç•Œé¢è¯´æ˜
```
ç”¨æˆ·Tokenç®¡ç†
â”œâ”€â”€ ç”¨æˆ·ï¼šæè¿ª (lidi10)
â”œâ”€â”€ é‚®ç®±ï¼šlidi10@126.com
â”œâ”€â”€ JWT Tokenï¼š
â”‚   â””â”€â”€ [é•¿æ–‡æœ¬æ¡†æ˜¾ç¤ºå®Œæ•´Token]
â””â”€â”€ æ“ä½œæŒ‰é’®ï¼š
    â”œâ”€â”€ åˆ·æ–°Token
    â”œâ”€â”€ åˆ·æ–°Token+ç‰ˆæœ¬å·
    â””â”€â”€ å…³é—­
```

#### ğŸ’¡ Tokenæ“ä½œè¯´æ˜
- **åˆ·æ–°Token**ï¼šç”Ÿæˆæ–°çš„Tokenï¼Œä¿æŒç›¸åŒç‰ˆæœ¬å·
- **åˆ·æ–°Token+ç‰ˆæœ¬å·**ï¼šç”Ÿæˆæ–°Tokenå¹¶æ›´æ–°ç‰ˆæœ¬å·ï¼ˆä¼šä½¿æ—§Tokenå¤±æ•ˆï¼‰
- **å¤åˆ¶Token**ï¼šç›´æ¥ä»æ–‡æœ¬æ¡†å¤åˆ¶å®Œæ•´Token

### æ–¹å¼äºŒï¼šAPIæ¥å£è·å–ï¼ˆå¤‡é€‰ï¼‰

#### ğŸ“ curlå‘½ä»¤
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "username": "aigc_user",
    "password": "Abc123456!"
  }' \
  http://localhost:8081/api/v1/auth/login
```

#### ğŸ“‹ å“åº”ç¤ºä¾‹
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 10,
      "username": "aigc_user",
      "name": "å¼ ä¸‰",
      "department": "AIç ”å‘éƒ¨",
      "role": "AIç ”å‘å·¥ç¨‹å¸ˆ"
    },
    "expires_at": "2024-01-27T10:30:00Z"
  }
}
```

### ğŸ’¾ ä¿å­˜Token

#### ğŸ–¥ï¸ ç¯å¢ƒå˜é‡æ–¹å¼ï¼ˆæ¨èï¼‰
```bash
# ä¿å­˜Tokenåˆ°ç¯å¢ƒå˜é‡
export API_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# éªŒè¯ç¯å¢ƒå˜é‡
echo $API_TOKEN
```

#### ğŸ“ æ–‡ä»¶ä¿å­˜æ–¹å¼
```bash
# ä¿å­˜åˆ°æ–‡ä»¶
echo "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." > token.txt

# ä»æ–‡ä»¶è¯»å–
API_TOKEN=$(cat token.txt)
```

#### ğŸ“‹ é…ç½®æ–‡ä»¶æ–¹å¼
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > api_config.sh << EOF
#!/bin/bash
export API_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
export API_BASE_URL="http://localhost:8081"
EOF

# åŠ è½½é…ç½®
source api_config.sh
```

### âœ… éªŒè¯ç»“æœ
- âœ… æˆåŠŸè·å–æœ‰æ•ˆçš„JWT Token
- âœ… TokenåŒ…å«æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯
- âœ… Tokenå¯ä»¥æ­£å¸¸ä¿å­˜å’Œä½¿ç”¨

---

## ğŸ§ª æ­¥éª¤8ï¼šAPIæƒé™æµ‹è¯•

### ğŸ” æƒé™æ£€æŸ¥æµ‹è¯•
```bash
# ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„Token
curl -s -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_TOKEN" \
  -d '{
    "api_path": "/api/v1/apis",
    "method": "GET"
  }' \
  http://localhost:8081/api/v1/api/check-permission
```

### ğŸ“‹ é¢„æœŸå“åº”
```json
{
  "code": 200,
  "message": "æƒé™æ£€æŸ¥æˆåŠŸ",
  "data": {
    "allowed": true,
    "reason": "ç”¨æˆ·å…·æœ‰è®¿é—®æƒé™",
    "user": "aigc_user",
    "role": "aigc_engineer",
    "resource": "/api/v1/apis",
    "action": "GET"
  }
}
```

### ğŸ§ª åŠŸèƒ½APIæµ‹è¯•
```bash
# æµ‹è¯•ä¸šåŠ¡çº¿åˆ—è¡¨API
curl -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/business

# æµ‹è¯•APIåˆ—è¡¨API
curl -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/apis

# æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API
curl -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/user/profile
```

### âœ… éªŒè¯ç»“æœ
- APIæƒé™æ£€æŸ¥é€šè¿‡
- åŠŸèƒ½APIè°ƒç”¨æˆåŠŸ
- æ— æƒé™APIè¢«æ­£ç¡®æ‹’ç»

---

## ğŸ“Š å®ŒæˆçŠ¶æ€æ£€æŸ¥

### âœ… æµç¨‹å®Œæˆæ£€æŸ¥æ¸…å•

| æ­¥éª¤ | ä»»åŠ¡ | çŠ¶æ€ | éªŒè¯æ–¹æ³• |
|------|------|------|----------|
| 1 | éƒ¨é—¨åˆ›å»º | â¬œ | éƒ¨é—¨åˆ—è¡¨ä¸­å¯è§ |
| 2 | è§’è‰²åˆ›å»º | â¬œ | è§’è‰²åˆ—è¡¨ä¸­å¯è§ |
| 3 | ç”¨æˆ·åˆ›å»º | â¬œ | ç”¨æˆ·åˆ—è¡¨ä¸­å¯è§ |
| 4 | APIæƒé™é…ç½® | â¬œ | æ•°æ®åº“æƒé™è®°å½•å­˜åœ¨ |
| 5 | èœå•æƒé™é…ç½® | â¬œ | å‰ç«¯èœå•æ˜¾ç¤ºæ­£ç¡® |
| 6 | ç™»å½•éªŒè¯ | â¬œ | ç”¨æˆ·å¯æ­£å¸¸ç™»å½• |
| 7 | Tokenè·å– | â¬œ | APIè¿”å›æœ‰æ•ˆToken |
| 8 | APIæƒé™æµ‹è¯• | â¬œ | æƒé™æ£€æŸ¥é€šè¿‡ |

### ğŸ¯ æˆåŠŸæ ‡å‡†
- âœ… æ‰€æœ‰æ£€æŸ¥é¡¹ç›®å‡ä¸ºå®ŒæˆçŠ¶æ€
- âœ… ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨åˆ†é…çš„åŠŸèƒ½
- âœ… æƒé™æ§åˆ¶æŒ‰é¢„æœŸå·¥ä½œ

---

## âš ï¸ æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

### ğŸ”’ å®‰å…¨å»ºè®®
1. **å¯†ç ç­–ç•¥**
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 
   - å¯ç”¨å¯†ç å¤æ‚åº¦è¦æ±‚

2. **æƒé™æœ€å°åŒ–åŸåˆ™**
   - åªæˆäºˆå¿…è¦çš„APIè®¿é—®æƒé™
   - å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
   - åŠæ—¶å›æ”¶ç¦»èŒäººå‘˜æƒé™

3. **Tokenå®‰å…¨**
   - å¦¥å–„ä¿ç®¡è®¿é—®ä»¤ç‰Œ
   - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
   - é¿å…åœ¨æ—¥å¿—ä¸­è®°å½•Token

### ğŸ”§ æ•…éšœæ’é™¤

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ | æ£€æŸ¥å‘½ä»¤ |
|------|----------|----------|----------|
| ç™»å½•å¤±è´¥ | ç”¨æˆ·å/å¯†ç é”™è¯¯ | æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯ï¼Œé‡ç½®å¯†ç  | `SELECT * FROM users WHERE username='aigc_user';` |
| èœå•ä¸æ˜¾ç¤º | èœå•æƒé™æœªé…ç½® | æ£€æŸ¥è§’è‰²èœå•æƒé™è®¾ç½® | åœ¨ç®¡ç†ç•Œé¢æ£€æŸ¥èœå•æƒé™é…ç½® |
| APIè®¿é—®è¢«æ‹’ç» | APIæƒé™æœªé…ç½® | æ£€æŸ¥Casbinæƒé™è§„åˆ™ | `SELECT * FROM casbin_rule WHERE v0='aigc_engineer';` |
| Tokenæ— æ•ˆ | Tokenè¿‡æœŸæˆ–æ ¼å¼é”™è¯¯ | é‡æ–°è·å–Token | åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢åˆ·æ–°Token |
| é¡µé¢404é”™è¯¯ | è·¯ç”±æƒé™é—®é¢˜ | æ£€æŸ¥å‰ç«¯è·¯ç”±æƒé™é…ç½® | æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ |
| éƒ¨é—¨ä»£ç é‡å¤ | éƒ¨é—¨ä»£ç å·²å­˜åœ¨ | ä½¿ç”¨å”¯ä¸€çš„éƒ¨é—¨ä»£ç  | `SELECT * FROM departments WHERE code='aigc';` |
| è§’è‰²åˆ›å»ºå¤±è´¥ | è§’è‰²ä»£ç é‡å¤ | ä½¿ç”¨å”¯ä¸€çš„è§’è‰²ä»£ç  | `SELECT * FROM roles WHERE code='aigc_engineer';` |
| æƒé™ä¸ç”Ÿæ•ˆ | ç¼“å­˜æœªåˆ·æ–° | é‡å¯åç«¯æœåŠ¡æˆ–æ¸…é™¤ç¼“å­˜ | `curl http://localhost:8081/api/v1/auth/reload-policy` |

### ğŸ“ æŠ€æœ¯æ”¯æŒ

#### ğŸ” å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:8081/health

# æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:8082/

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -u root -plidi10 -h localhost -e "SELECT 1"
```

#### ğŸ“‹ æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f backend/logs/api-auth.log

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -u mcprapi-backend -f
```

#### ğŸ“§ è”ç³»æ–¹å¼
- **æŠ€æœ¯æ–‡æ¡£**ï¼šæŸ¥çœ‹é¡¹ç›®README.md
- **é—®é¢˜åé¦ˆ**ï¼šæäº¤GitHub Issue
- **ç´§æ€¥æ”¯æŒ**ï¼šè”ç³»ç³»ç»Ÿç®¡ç†å‘˜

---

## ğŸš€ å¿«é€Ÿæ“ä½œæŒ‡å—

### âš¡ ä¸€é”®åˆ›å»ºéƒ¨é—¨è„šæœ¬

åˆ›å»ºä¸€ä¸ªå¿«é€Ÿéƒ¨é—¨åˆ›å»ºè„šæœ¬ï¼š

```bash
#!/bin/bash
# æ–‡ä»¶åï¼šcreate_department.sh

# é…ç½®å‚æ•°
DEPT_NAME="$1"
DEPT_CODE="$2"
USER_NAME="$3"
USER_PASSWORD="$4"
USER_EMAIL="$5"

# æ£€æŸ¥å‚æ•°
if [ $# -ne 5 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <éƒ¨é—¨åç§°> <éƒ¨é—¨ä»£ç > <ç”¨æˆ·å> <å¯†ç > <é‚®ç®±>"
    echo "ç¤ºä¾‹: $0 'AIç ”å‘éƒ¨' 'aigc' 'aigc_user' 'Abc123456!' 'user@company.com'"
    exit 1
fi

echo "ğŸ¢ å¼€å§‹åˆ›å»ºéƒ¨é—¨: $DEPT_NAME ($DEPT_CODE)"
echo "ğŸ‘¤ åˆ›å»ºç”¨æˆ·: $USER_NAME"
echo "ğŸ“§ é‚®ç®±: $USER_EMAIL"
echo ""

# è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªåŠ¨åŒ–åˆ›å»ºé€»è¾‘
# 1. è°ƒç”¨APIåˆ›å»ºéƒ¨é—¨
# 2. åˆ›å»ºè§’è‰²
# 3. åˆ›å»ºç”¨æˆ·
# 4. é…ç½®æƒé™

echo "âœ… éƒ¨é—¨åˆ›å»ºå®Œæˆï¼"
echo "ğŸ“‹ è¯·æŒ‰ç…§æ–‡æ¡£æ­¥éª¤4-8å®Œæˆæƒé™é…ç½®"
```

### ğŸ” å¸¸ç”¨æ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥éƒ¨é—¨æ˜¯å¦å­˜åœ¨
mysql -u root -plidi10 -h localhost -e "
USE api_auth_dev; 
SELECT id, name, code, status FROM departments WHERE code='aigc';"

# æ£€æŸ¥è§’è‰²æƒé™
mysql -u root -plidi10 -h localhost -e "
USE api_auth_dev; 
SELECT * FROM casbin_rule WHERE v0='aigc_engineer';"

# æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
mysql -u root -plidi10 -h localhost -e "
USE api_auth_dev; 
SELECT u.id, u.username, u.name, d.name as dept_name, r.name as role_name 
FROM users u 
LEFT JOIN departments d ON u.dept_id = d.id 
LEFT JOIN roles r ON u.role_id = r.id 
WHERE u.username='aigc_user';"

# æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
curl -s http://localhost:8081/health | jq '.'

# æ£€æŸ¥Tokenæœ‰æ•ˆæ€§
curl -s -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/user/profile | jq '.'
```

### ğŸ“Š æƒé™éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# æ–‡ä»¶åï¼šverify_permissions.sh

API_TOKEN="$1"
if [ -z "$API_TOKEN" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <API_TOKEN>"
    exit 1
fi

echo "ğŸ” å¼€å§‹éªŒè¯APIæƒé™..."

# æµ‹è¯•APIåˆ—è¡¨æƒé™
echo "ğŸ“‹ æµ‹è¯•APIåˆ—è¡¨æƒé™..."
curl -s -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/apis | jq '.code'

# æµ‹è¯•ä¸šåŠ¡çº¿æƒé™
echo "ğŸ¢ æµ‹è¯•ä¸šåŠ¡çº¿æƒé™..."
curl -s -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/business | jq '.code'

# æµ‹è¯•ç”¨æˆ·ä¿¡æ¯æƒé™
echo "ğŸ‘¤ æµ‹è¯•ç”¨æˆ·ä¿¡æ¯æƒé™..."
curl -s -H "Authorization: Bearer $API_TOKEN" \
  http://localhost:8081/api/v1/user/profile | jq '.code'

echo "âœ… æƒé™éªŒè¯å®Œæˆï¼"
```

### ğŸ› ï¸ æƒé™ä¿®å¤è„šæœ¬

```bash
#!/bin/bash
# æ–‡ä»¶åï¼šfix_permissions.sh

ROLE_CODE="$1"
if [ -z "$ROLE_CODE" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <è§’è‰²ä»£ç >"
    echo "ç¤ºä¾‹: $0 aigc_engineer"
    exit 1
fi

echo "ğŸ”§ å¼€å§‹ä¿®å¤è§’è‰²æƒé™: $ROLE_CODE"

# åˆ é™¤ç°æœ‰æƒé™
mysql -u root -plidi10 -h localhost -e "
USE api_auth_dev; 
DELETE FROM casbin_rule WHERE v0='$ROLE_CODE';"

# é‡æ–°æ·»åŠ åŸºç¡€æƒé™
mysql -u root -plidi10 -h localhost -e "
USE api_auth_dev; 
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3, v4, v5) VALUES 
('p', '$ROLE_CODE', '/api/v1/apis*', '*', '*', 'allow', ''),
('p', '$ROLE_CODE', '/api/v1/apis/*', '*', '*', 'allow', ''),
('p', '$ROLE_CODE', '/api/v1/business*', '*', '*', 'allow', ''),
('p', '$ROLE_CODE', '/api/v1/business/*', '*', '*', 'allow', ''),
('p', '$ROLE_CODE', '/api/v1/departments*', 'GET', '*', 'allow', ''),
('p', '$ROLE_CODE', '/api/v1/users*', 'GET,POST,PUT', '*', 'allow', '');"

# é‡æ–°åŠ è½½æƒé™ç­–ç•¥
curl -X POST http://localhost:8081/api/v1/auth/reload-policy

echo "âœ… æƒé™ä¿®å¤å®Œæˆï¼"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—](./DATABASE_INIT.md)
- [Dockeréƒ¨ç½²æ–‡æ¡£](./DOCKER_DEPLOYMENT.md)
- [APIæ¥å£æ–‡æ¡£](./backend/docs/)
- [Casbinæƒé™ç®¡ç†](./backend/docs/casbin_policy_management.md)

### ğŸ“– æ‰©å±•é˜…è¯»

- [JWT Tokenæœ€ä½³å®è·µ](https://jwt.io/introduction/)
- [Casbinæƒé™æ¨¡å‹](https://casbin.org/docs/zh-CN/model-syntax)
- [Vue.jsæƒé™æ§åˆ¶](https://router.vuejs.org/guide/advanced/navigation-guards.html)
- [MySQLç”¨æˆ·æƒé™ç®¡ç†](https://dev.mysql.com/doc/refman/8.0/en/privilege-system.html)

### ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
   ```sql
   -- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
   CREATE INDEX idx_users_username ON users(username);
   CREATE INDEX idx_casbin_rule_v0 ON casbin_rule(v0);
   CREATE INDEX idx_departments_code ON departments(code);
   ```

2. **ç¼“å­˜ç­–ç•¥**
   - æƒé™ä¿¡æ¯ç¼“å­˜ï¼šRedisç¼“å­˜ç”¨æˆ·æƒé™
   - Tokenç¼“å­˜ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢
   - èœå•ç¼“å­˜ï¼šå‰ç«¯èœå•æƒé™ç¼“å­˜

3. **ç›‘æ§æŒ‡æ ‡**
   - APIå“åº”æ—¶é—´
   - æƒé™æ£€æŸ¥è€—æ—¶
   - æ•°æ®åº“è¿æ¥æ•°
   - å†…å­˜ä½¿ç”¨ç‡

---

*ğŸ“ æ–‡æ¡£ç‰ˆæœ¬ï¼šv2.1 | æœ€åæ›´æ–°ï¼š2024-01-26 | ç»´æŠ¤è€…ï¼šç³»ç»Ÿç®¡ç†å‘˜*
